{{> partials/header}}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-xl-10">
            <div class="app-card p-4 p-md-5 mb-4 text-dark">
                <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
                    <div>
                        <h2 class="h3 mb-2">Panel de Administración</h2>
                        <p class="text-muted mb-0">Estadísticas generales del juego y reportes.</p>
                    </div>
                    <div class="d-flex gap-2">
                        <a href="/admin/users" class="btn btn-info btn-lg fw-semibold shadow-sm text-white">
                            <i class="bi bi-people me-2"></i>Gestionar Usuarios
                        </a>
                        <a href="/admin/generateReport" class="btn btn-primary btn-lg fw-semibold shadow-sm">
                            <i class="bi bi-file-earmark-pdf me-2"></i>Descargar Reporte PDF
                        </a>
                    </div>
                </div>
            </div>

            <div class="row g-4 mb-4">
                <!-- Total Games -->
                <div class="col-12 col-md-6">
                    <div class="app-card p-4 h-100 text-dark border-start border-4 border-primary">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Partidas Jugadas</h5>
                        <div class="d-flex align-items-center">
                            <h2 class="display-4 fw-bold mb-0 me-3">{{stats.total_games}}</h2>
                            <i class="bi bi-controller fs-1 text-primary opacity-25 ms-auto"></i>
                        </div>
                        <small class="text-muted">Total histórico de partidas</small>
                    </div>
                </div>

                <!-- Total Score -->
                <div class="col-12 col-md-6">
                    <div class="app-card p-4 h-100 text-dark border-start border-4 border-success">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Puntaje Total</h5>
                        <div class="d-flex align-items-center">
                            <h2 class="display-4 fw-bold mb-0 me-3">{{stats.total_score}}</h2>
                            <i class="bi bi-trophy fs-1 text-success opacity-25 ms-auto"></i>
                        </div>
                        <small class="text-muted">Suma de todos los puntajes</small>
                    </div>
                </div>

                <!-- Total Players -->
                <div class="col-12 col-md-6">
                    <div class="app-card p-4 h-100 text-dark border-start border-4 border-info">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Jugadores Registrados</h5>
                        <div class="d-flex align-items-center">
                            <h2 class="display-4 fw-bold mb-0 me-3">{{stats.total_players}}</h2>
                            <i class="bi bi-people fs-1 text-info opacity-25 ms-auto"></i>
                        </div>
                        <small class="text-muted">Usuarios con rol de jugador</small>
                    </div>
                </div>

                <!-- Total Questions -->
                <!-- Total Questions -->
                <div class="col-12 col-md-6 col-lg-3">
                    <div class="app-card p-4 h-100 text-dark border-start border-4 border-warning">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Total Preguntas</h5>
                        <div class="d-flex align-items-center">
                            <h2 class="display-4 fw-bold mb-0 me-3">{{stats.total_questions}}</h2>
                        </div>
                    </div>
                </div>

                <!-- Active Questions -->
                <div class="col-12 col-md-6 col-lg-3">
                    <div class="app-card p-4 h-100 text-dark border-start border-4 border-success">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Activas</h5>
                        <div class="d-flex align-items-center">
                            <h2 class="display-4 fw-bold mb-0 me-3">{{stats.active_questions}}</h2>
                            <i class="bi bi-check-circle fs-1 text-success opacity-25 ms-auto"></i>
                        </div>
                    </div>
                </div>

                <!-- Suggested Questions -->
                <div class="col-12 col-md-6 col-lg-3">
                    <div class="app-card p-4 h-100 text-dark border-start border-4 border-info">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Sugeridas</h5>
                        <div class="d-flex align-items-center">
                            <h2 class="display-4 fw-bold mb-0 me-3">{{stats.suggested_questions}}</h2>
                            <i class="bi bi-lightbulb fs-1 text-info opacity-25 ms-auto"></i>
                        </div>
                    </div>
                </div>

                <!-- Rejected Questions -->
                <div class="col-12 col-md-6 col-lg-3">
                    <div class="app-card p-4 h-100 text-dark border-start border-4 border-danger">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Rechazadas</h5>
                        <div class="d-flex align-items-center">
                            <h2 class="display-4 fw-bold mb-0 me-3">{{stats.rejected_questions}}</h2>
                            <i class="bi bi-x-circle fs-1 text-danger opacity-25 ms-auto"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-12 col-lg-4">
                    <div class="app-card p-4 h-100 text-dark">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Preguntas por Estado</h5>
                        <canvas id="questionsStatusChart"></canvas>
                    </div>
                </div>
                <div class="col-12 col-lg-4">
                    <div class="app-card p-4 h-100 text-dark">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Usuarios por Dificultad</h5>
                        <canvas id="usersDifficultyChart"></canvas>
                    </div>
                </div>
                <div class="col-12 col-lg-4">
                    <div class="app-card p-4 h-100 text-dark">
                        <h5 class="text-muted text-uppercase small fw-bold mb-3">Preguntas por Categoría</h5>
                        <canvas id="questionsCategoryChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="app-card p-4 p-md-5 text-dark">
                <h4 class="mb-4">Jugadores por Nivel de Dificultad</h4>
                <div class="row g-4">
                    {{#stats.difficulty_levels}}
                        <div class="col-6 col-md-4">
                            <div class="p-3 bg-light rounded text-center border">
                                <h3 class="fw-bold text-primary mb-1">{{Principiante}}</h3>
                                <small class="text-muted fw-semibold">Principiante</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-4">
                            <div class="p-3 bg-light rounded text-center border">
                                <h3 class="fw-bold text-warning mb-1">{{Medio}}</h3>
                                <small class="text-muted fw-semibold">Medio</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-4">
                            <div class="p-3 bg-light rounded text-center border">
                                <h3 class="fw-bold text-danger mb-1">{{Avanzado}}</h3>
                                <small class="text-muted fw-semibold">Avanzado</small>
                            </div>
                        </div>
                    {{/stats.difficulty_levels}}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stats = {{{statsJson}}};

        // Questions by Status Chart
        new Chart(document.getElementById('questionsStatusChart'), {
            type: 'doughnut',
            data: {
                labels: ['Activas', 'Sugeridas', 'Rechazadas'],
                datasets: [{
                    data: [stats.active_questions, stats.suggested_questions, stats.rejected_questions],
                    backgroundColor: ['#198754', '#0dcaf0', '#dc3545']
                }]
            },
            options: { responsive: true }
        });

        // Users by Difficulty Chart
        new Chart(document.getElementById('usersDifficultyChart'), {
            type: 'bar',
            data: {
                labels: ['Principiante', 'Medio', 'Avanzado'],
                datasets: [{
                    label: 'Usuarios',
                    data: [
                        stats.difficulty_levels.Principiante,
                        stats.difficulty_levels.Medio,
                        stats.difficulty_levels.Avanzado
                    ],
                    backgroundColor: ['#0d6efd', '#ffc107', '#dc3545']
                }]
            },
            options: { responsive: true }
        });

        // Questions by Category Chart
        const categoryLabels = Object.keys(stats.questions_by_category);
        const categoryData = Object.values(stats.questions_by_category);

        new Chart(document.getElementById('questionsCategoryChart'), {
            type: 'pie',
            data: {
                labels: categoryLabels,
                datasets: [{
                    data: categoryData,
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                    ]
                }]
            },
            options: { responsive: true }
        });
    });
</script>

{{> partials/footer}}
