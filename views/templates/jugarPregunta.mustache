{{>partials/header}}

<section class="container">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
            <div class="app-card p-5 text-dark">
                {{#reportSuccess}}
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        ¡Gracias! Registramos tu reporte y seguiremos revisando la pregunta.
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {{/reportSuccess}}
                {{#reportError}}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        {{reportError}}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {{/reportError}}

                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="badge bg-primary fs-6">Pregunta {{pregunta_numero}} de {{total_preguntas}}</span>
                        <div class="text-end">
                            <span class="fs-4 fw-bold text-danger" id="timerDisplay">{{remaining_time_int}}s</span>
                        </div>
                    </div>
                    <div class="progress" style="width: 100%; height: 10px;">
                        <div class="progress-bar bg-danger" role="progressbar" id="timerBar" style="width: 100%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="10"></div>
                    </div>
                </div>

                <h2 class="display-6 fw-bold mb-4 text-center">{{pregunta.question_text}}</h2>

                <form action="/partida/procesarRespuesta" method="POST" class="mt-4" id="questionForm">
                    <input type="hidden" name="question_id" value="{{pregunta.question_id}}">
                    
                    <div class="d-grid gap-3">
                        {{#respuestas}}
                            <button type="submit" name="answer_id" value="{{answer_id}}" class="btn btn-primary btn-lg text-start p-3">
                                {{answer_text}}
                            </button>
                        {{/respuestas}}
                        
                        {{^respuestas}}
                            <div class="alert alert-warning">
                                No hay respuestas disponibles para esta pregunta (ID: {{pregunta.question_id}}).
                                <br>
                                Por favor, reportá este error.
                            </div>
                        {{/respuestas}}
                    </div>
                </form>

                <div class="mt-4 text-center">
                    <small class="text-muted">Seleccioná una respuesta para continuar</small>
                </div>

                <!-- Report button moved to feedback screen -->
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar tiempo restante desde el servidor, o 10 por defecto
        let timeLeft = parseFloat('{{remaining_time}}');
        if (isNaN(timeLeft)) timeLeft = 10;
        
        const timerDisplay = document.getElementById('timerDisplay');
        const timerBar = document.getElementById('timerBar');
        const form = document.getElementById('questionForm');
        
        const timerInterval = setInterval(function() {
            timeLeft -= 1; // Restamos 1 segundo
            
            // Actualizar visualización (redondeamos hacia arriba para mostrar 10, 9, 8...)
            let displayTime = Math.ceil(timeLeft);
            if (displayTime < 0) displayTime = 0;
            
            if (timerDisplay) timerDisplay.textContent = displayTime + 's';
            if (timerBar) {
                const percentage = (timeLeft / 10) * 100;
                timerBar.style.width = percentage + '%';
            }
            
            // Tiempo agotado
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                
                // Crear input hidden para enviar respuesta incorrecta (timeout)
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'answer_id';
                input.value = '-1'; // Valor inválido para indicar timeout/incorrecto
                form.appendChild(input);
                
                form.submit();
            }
        }, 1000);
    });
</script>

{{>partials/footer}}
