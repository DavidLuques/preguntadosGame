{{> partials/header}}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
            <div class="app-card p-4 p-md-5 text-dark">
                <div class="row align-items-center">
                    <div class="col-md-6 text-center text-md-start mb-4 mb-md-0">
                        <div class="d-flex flex-column flex-md-row align-items-center gap-4">
                            <img src="{{#user.profile_picture}}/{{user.profile_picture}}{{/user.profile_picture}}{{^user.profile_picture}}/images/default_profile.png{{/user.profile_picture}}" 
                                 alt="Foto de Perfil" 
                                 class="rounded-circle img-thumbnail shadow-sm" 
                                 style="width: 120px; height: 120px; object-fit: cover;">
                            
                            <div class="text-center text-md-start">
                                <h2 class="fw-bold mb-1">{{user.username}}</h2>
                                <p class="text-muted mb-2 d-flex align-items-center pr-1 justify-content-start">
                                    <i class="bi bi-geo-alt-fill me-1"></i>

                                    {{#user.location}}{{user.location}}{{/user.location}}
                                    {{^user.location}}Ubicaci√≥n desconocida{{/user.location}}

                                    {{#user.country_code}}
                                        <img src=""
                                            width="24" height="18"
                                            class="ms-2 border rounded"
                                            alt="Flag"
                                            id="flag">
                                    {{/user.country_code}}
                                </p>
                                <span class="badge bg-primary">Jugador</span>
                            </div>
                        </div>

                        <div class="mt-4">
                            <div id="map" style="width: 100%; height: 250px;" class="rounded shadow-sm mt-3"></div>

                                <input type="hidden" id="lat" value="{{lat}}">
                                <input type="hidden" id="lon" value="{{lon}}">
                        </div>

                        <div class="row mt-4 g-3">
                            <div class="col-6">
                                <div class="p-3 bg-light rounded text-center">
                                    <h4 class="fw-bold mb-0 text-primary">{{user.total_score}}</h4>
                                    <small class="text-muted">Puntos Totales</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded text-center">
                                    <h4 class="fw-bold mb-0 text-success">{{user.games_played}}</h4>
                                    <small class="text-muted">Partidas Jugadas</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 text-center border-start-md ps-md-5">
                        <h5 class="fw-bold mb-3">Escanea para ver perfil</h5>
                        <div class="bg-white p-3 d-inline-block rounded shadow-sm border">
                            <img src="{{qr_code_url}}" alt="QR Code del Perfil" class="img-fluid" style="width: 180px; height: 180px;">
                        </div>
                        <p class="small text-muted mt-2 mb-0">Comparte este perfil con tus amigos</p>
                    </div>
                </div>

                <div class="mt-4 pt-4 border-top text-center">
                    <a href="/" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i>Volver al Ranking
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const lat = parseFloat(document.getElementById("lat").value || "0");
        const lon = parseFloat(document.getElementById("lon").value || "0");

        const hasLocation = lat !== 0 && lon !== 0;

        const map = L.map("map").setView(
            hasLocation ? [lat, lon] : [0, 0],
            hasLocation ? 13 : 2
        );

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19
        }).addTo(map);

        if (hasLocation) {
            L.marker([lat, lon]).addTo(map);
        }
    });
</script>

<script> 
    document.addEventListener("DOMContentLoaded", () => {
        const code = "{{user.country_code}}";
        const lower = code.toLowerCase();
        document.getElementById("flag").src = `https://flagcdn.com/${lower}.svg`;
    });
</script>

{{> partials/footer}}
